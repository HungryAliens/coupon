import{getLanguageCode,setLanguageCode,getLanguageData,getSupportingLanguages}from"./i18n.js";import{SERVER_NAMES,requestRedeem}from"./redeem.js";export function initialize(){const e=_collectEventElements(),t=_collectTextElements(),n=_collectInputElements();_initializeEventListeners(e,t,n),_initializeDropdowns(e.languageDropdown,n.serverSelect),_updateTextElements(t)}function _collectEventElements(){return{redeemButton:document.getElementById("redeem-button"),languageDropdown:document.getElementById("language-dropdown"),modal:document.getElementById("result-modal"),closeButtons:document.querySelectorAll(".close-button, #modal-close-button")}}function _collectTextElements(){return document.querySelectorAll("[data-i18n-key], [data-i18n-placeholder-key]")}function _collectInputElements(){return{serverSelect:document.getElementById("server-dropdown"),accountNameInput:document.getElementById("account-name"),couponCodeInput:document.getElementById("coupon-code")}}function _initializeEventListeners(e,t,n){const{redeemButton:o,languageDropdown:a,modal:l,closeButtons:d}=e;a.addEventListener("change",(e=>_onDropdownChange(e.target.value,t))),o.addEventListener("click",(()=>_onRedeemClick(n,o,l))),d.forEach((e=>e.addEventListener("click",(()=>_onCloseClick(l))))),window.addEventListener("click",(e=>_onModalOutsideClick(e.target,l)))}function _initializeDropdowns(e,t){const n=getSupportingLanguages(),o=getLanguageCode();e.innerHTML="",n.forEach((({code:t,name:n})=>{const a=document.createElement("option");a.textContent=n,a.value=t,a.selected=t===o,e.appendChild(a)})),SERVER_NAMES.forEach((e=>{const n=document.createElement("option");n.textContent=e,n.value=e,t.appendChild(n)}))}function _updateTextElements(e){const t=getLanguageCode(),n=getLanguageData();e.forEach((e=>{const t=e.getAttribute("data-i18n-key");t&&void 0!==n[t]&&(e.textContent=n[t]);const o=e.getAttribute("data-i18n-placeholder-key");o&&void 0!==n[o]&&e.setAttribute("placeholder",n[o])})),document.documentElement.setAttribute("lang",t)}function _onDropdownChange(e,t){setLanguageCode(e),_updateTextElements(t)}async function _onRedeemClick(e,t,n){const o=getLanguageData();_setRedeemButtonDisabled(t,!0,o.pending);{const{serverSelect:t,accountNameInput:o,couponCodeInput:a}=e,l=t.value,d=o.value.trim(),c=a.value.trim();_showModal(n,await requestRedeem(l,d,c))}_setRedeemButtonDisabled(t,!1,o.redeem_button)}function _onCloseClick(e){_hideModal(e)}function _onModalOutsideClick(e,t){e===t&&_hideModal(t)}function _setRedeemButtonDisabled(e,t,n){e.disabled=t,e.textContent=n}function _showModal(e,t){e.querySelector("#modal-message").textContent=t,e.style.display="block"}function _hideModal(e){e.style.display="none"}